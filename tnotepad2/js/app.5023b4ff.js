(function(t){function e(e){for(var n,o,a=e[0],c=e[1],l=e[2],d=0,u=[];d<a.length;d++)o=a[d],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&u.push(s[o][0]),s[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);h&&h(e);while(u.length)u.shift()();return r.push.apply(r,l||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],n=!0,a=1;a<i.length;a++){var c=i[a];0!==s[c]&&(n=!1)}n&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},s={app:0},r=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/tnotepad2/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var h=c;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"00f6":function(t,e,i){"use strict";var n=i("4ec7"),s=i.n(n);s.a},"15f4":function(t,e,i){},"1ca0":function(t,e,i){"use strict";var n=i("15f4"),s=i.n(n);s.a},"1dc6":function(t,e,i){"use strict";var n=i("2563"),s=i.n(n);s.a},2563:function(t,e,i){},"4ec7":function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);var n=i("2b0e"),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"root"}},[i("ActionsBar",{attrs:{id:"ActionsBar"}}),i("NoteContainer")],1)},r=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{attrs:{id:"actionsBar"}},[i("div",{staticClass:"button cell",attrs:{id:"download_button"},on:{click:t.download}},[t._v(" Download ")]),i("div",{staticClass:"button cell",attrs:{id:"upload_button"},on:{click:t.clickInput}},[t._v(" Upload ")]),i("input",{staticClass:"cell",staticStyle:{display:"none"},attrs:{id:"in",type:"file",accept:".tnp"}})])])},a=[],c={name:"ActionsBar",components:{},data(){return{inputElement:null}},methods:{download(){var t=this.$store.getters.getNotes;t=this.returnCopyWithoutOrphans(t);var e=JSON.stringify(t),i=new Blob([e],{type:"application/octet-binary"}),n=document.createElement("a");n.setAttribute("href",URL.createObjectURL(i)),n.setAttribute("download",document.title+".tnp"),n.click()},upload(){var t=this.$store,e=this.inputElement.files[0];"TNotepad"==document.title&&(document.title=e.name.slice(0,-4)),e.text().then(i=>{var n=JSON.parse(i);t.commit("loadNotes",{new_notes:n,fileName:e.name})}),this.inputElement.value=null},clickInput(){this.inputElement.click()},returnCopyWithoutOrphans(t){var e,i,n,s=JSON.parse(JSON.stringify(t)),r={};for(e in t){var o=t[e].children;for(i in o){var a=o[i];r[a]=1}}for(n in s)1!=r[n]&&0!=n&&delete s[n];return s}},created(){document.addEventListener("keydown",t=>{switch(t.key){case"s":t.ctrlKey&&(t.preventDefault(),this.download());break;case"o":t.ctrlKey&&(t.preventDefault(),document.getElementById("in").click());break}})},mounted(){this.inputElement=document.getElementById("in"),this.inputElement.addEventListener("input",t=>{this.upload()})}},l=c,h=(i("1ca0"),i("2877")),d=Object(h["a"])(l,o,a,!1,null,"27fd9dd8",null),u=d.exports,p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"rootDiv",class:{NoteContainer:!0,selected:t.isSelected,focused:t.isFocused},staticStyle:{padding:"2px"},on:{click:function(e){return e.stopPropagation(),t.onClick(e)}}},t._l(t.children,(function(t){return i("NoteInstance",{staticClass:"instance",attrs:{note_id:t}})})),1)},f=[],b=i("2f62"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"base"},[i("div",{ref:"rootDiv",class:{elements:!0,selected:t.isSelected,editable:t.isEditable,focused:t.isFocused,fihsn:t.focusedInstanceHasSameNote},style:{height:t.height+"px"},on:{click:function(e){return e.stopPropagation(),t.onClick(e)},dblclick:function(e){return e.stopPropagation(),t.onDblclick(e)}}},[i("button",{class:{boldButton:t.children.length>0},on:{click:t.toggleChildren}},[t._v(" "+t._s(t.button_text)+" ")]),i("textarea",{directives:[{name:"model",rawName:"v-model:value",value:t.text,expression:"text",arg:"value"}],attrs:{type:"text",spellcheck:t.SPELLCHECK,readonly:!t.isEditable},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}})]),t.children_instantiated?i("div",{class:{hidden:">"==t.button_text}},t._l(t.children,(function(t){return i("NoteInstance",{attrs:{note_id:t}})})),1):t._e()])},g=[],I={properties:{},methods:{NoteInstanceOnly:{onDblclick(t){this.$emit("dblclick",{instance:this,event:t})},toggleChildren(){this.children_instantiated=!0,this.button_text=">"==this.button_text?"v":">"},isVisible(){return 0!=this.$parent.$children.length&&(this.$parent==this.root||-1!=this.$parent.children.indexOf(this.note_id)&&this.$parent.isVisible()&&"v"==this.$parent.button_text)},previousSibling(){this.index;var t=0==this.index?0:this.index-1;return this.siblings[t]},nextSibling(){return this.siblings[this.index+1==this.siblings.length?this.index:this.index+1]},isLastSibling(){return this.index==this.siblings.length-1},shiftUp(){if(!this.isFirstSibling()){this.$store.commit("shiftUp",{parent:this.parentNote,child:this.note});var t=this.previousSibling(),e=this.button_text;this.button_text=t.button_text,t.button_text=e;e=this.children_instantiated;this.children_instantiated=t.children_instantiated,t.children_instantiated=e,this.$parent.$forceUpdate()}},shiftDown(){if(!this.isLastSibling()){this.$store.commit("shiftDown",{parent:this.parentNote,child:this.note});var t=this.nextSibling(),e=this.button_text;this.button_text=t.button_text,t.button_text=e;e=this.children_instantiated;this.children_instantiated=t.children_instantiated,t.children_instantiated=e,this.$parent.$forceUpdate()}},resize(){this.height<this.textArea.scrollHeight&&(this.height=this.textArea.scrollHeight),this.height>this.textArea.scrollHeight&&(this.height=0,this.$nextTick(function(){this.height=this.textArea.scrollHeight}.bind(this)))},scrollIntoView(){var t=this.textArea.getBoundingClientRect();(t.top<0||t.bottom>window.innerHeight)&&this.textArea.scrollIntoView()},expand(){this.isFolded&&this.toggleChildren()},collapse(){this.isFolded||this.toggleChildren()},isFirstSibling(){return 0==this.index},isLastSibling(){return this.index==this.siblings.length-1},indexAsSibling(){return this.$parent.$children.indexOf(this)},wasDeleted(){return-1==this.indexAsSibling()},removeFromParent(){-1!=this.$parent.$children.indexOf(this)&&this.$parent.removeChild(this)},select(){this.root.selectInstance(this)},deselect(){this.root.deselectInstance(this)}},shared:{addChild(t){this.$store.commit("addChildToParent",{child:t,parent:this.note})},removeChild(t){this.$store.commit("removeChildFromParent",{child:t.note,parent:this.note})},path(){return this==this.root?[this]:this.$parent.path().concat([this])},resizeAll(){setTimeout(this.resize,50),this.$children.forEach((function(t){t.resizeAll()}))},onClick(t){this.$emit("click",{instance:this,event:t})}}}},m={name:"NoteInstance",components:{},props:{note_id:Number},data(){return{button_text:">",children_instantiated:!1,is_root:!1,height:10}},methods:{...I.methods.NoteInstanceOnly,...I.methods.shared},computed:{...Object(b["c"])({children(t){var e=t.notes[this.note_id],i=e.children;return i},parents(t){return t.notes[this.note_id].parents},parentNote(t){return this.$parent.note},note(t){return t.notes[this.note_id]}}),primaryDiv(){return this.$el.children[0]},textArea(){return this.$el.children[0].children[1]},siblings(){return this.$parent.$children},index(){return this.indexAsSibling()},isFolded(){return">"==this.button_text},focusedInstanceHasSameNote(){return this.root.focusedInstanceNote==this.note&&this.root.focusedInstance!=this},editableElement:{set(t){this.root.editableElement=t},get(){return this.root.editableElement}},text:{set(t){this.root.showDescriptions?this.description=t:this.content=t},get(){return this.root.showDescriptions?this.description:this.content}},description:{set(t){this.$store.commit("setDescription",{id:this.note_id,description:t}),this.height!=this.textArea.scrollHeight&&this.resize()},get(){return this.$nextTick(this.resize.bind(this)),this.$store.getters.getDescription(this.note_id)}},content:{set(t){this.$store.commit("setContent",{id:this.note_id,content:t}),this.height!=this.textArea.scrollHeight&&this.resize()},get(){return this.$nextTick(this.resize.bind(this)),this.$store.getters.getContent(this.note_id)}},root(){return this.is_root?this:this.$parent.root},isSelected(){var t=this.root,e=t.instanceIsSelected(this);return e},isEditable(){return this.root.editableInstance==this},isFocused(){return this.root.focusedInstance==this},isExpanded(){return"v"==this.button_text},SPELLCHECK(){return this.$store.state.CONSTANTS.SPELLCHECK}},mounted(){this.$on("click",(function({instance:t,event:e}){this.$parent.$emit("click",{instance:t,event:e})})),this.$on("dblclick",(function({instance:t,event:e}){this.$parent.$emit("dblclick",{instance:t,event:e})})),"true"==this.note.autoExpand&&this.expand()}},x=m,_=(i("576b"),Object(h["a"])(x,v,g,!1,null,"39ee5a79",null)),$=_.exports,w={obj_val_replace:function(t,e,i){if(e!=i&&t){var n;for(n in t)n==e&&(t[i]=t[e],delete t[e]);for(n in t){var s=t[n];s==e&&(t[n]=i),"object"==typeof s&&(s instanceof Array?t[n]=s.map(t=>t==e?i:t):this.obj_val_replace(s,e,i))}}},mergeNotes:function(t,e){var i,n={},s=0;for(i in[t,e].forEach(function(t){for(i in t)this.obj_val_replace(t,i,s),s--;Object.assign(n,t)}.bind(this)),n)this.obj_val_replace(n,i,-i);return n}},S={name:"NoteContainer",components:{NoteInstance:$},data(){return{id:"",note_id:"0",_editableInstance:null,_selectedInstances:[this],_focusedInstance:this,root:this,is_root:!0,clipboard:{notes:[]},editableElement:null,showDescriptions:!1}},methods:{...I.methods.shared,callFn(t,e=!0,i=!1,n=function(){}){t=t.bind(this);var s=e?this.selectedInstances.filter(()=>!0):[this.selectedInstances[0]];while(s.length>0){var r=s.pop();!i&&r.is_root||t(r),this.$forceUpdate()}n()},selectThis(){this.selectInstance(this)},selectInstance(t,e=!0){e?this.selectedInstances.includes(t)||(this.selectedInstances=[...this.selectedInstances,t]):this.selectedInstances=[t]},deselectInstance(t){this.selectedInstances=this.selectedInstances.filter(e=>e!=t)},instanceIsSelected(t){return this.selectedInstances.includes(t)},focus(t,e=!1){this.focusedInstance=t,this.selectInstance(t,e),t.scrollIntoView()},highestSelectedInstance(){var t=this;do{if(t.isSelected)return t;t=this.nextVisibleInstance(t)}while(t!=this)},getNewNote(){var t=this.newId;this.$store.commit("registerNewNote",t);var e=this.$store.getters.getNoteById(t);return e},nextVisibleInstance(t){if(t.is_root&&0==t.$children.length)return t;if(t.$children.length>0)return t.$children[0];if(!t.isLastSibling())return t.nextSibling();var e=t.$parent;while(e!=t.root){if(!e.isLastSibling())return e.nextSibling();e=e.$parent}return e},previousVisibleInstance(t){var e=this,i=this.nextVisibleInstance(e);while(i!=t&&i!=this)e=i,i=this.nextVisibleInstance(e);return e},addToClipboard(t){this.clipboard.notes.push(t.note)},attachAllNotesOnClipboard(t){this.clipboard.notes.forEach(function(e){this.$store.commit("addChildToParent",{child:e,parent:t.note}),t.expand()}.bind(this))},clearEditable(){if(null!=this.$data._editableInstance){var t=this.$data._editableInstance.textArea;t.selectionStart=t.selectionEnd=0}this.$data._editableInstance=null},lowestVisibleElement(t){var e=0;while(t.length>e+1&&t[e+1].isVisible())e++;return t[e]},getOrderedSelectedInstances(){var t=[],e=this.nextVisibleInstance(this);while(e!=this)this.instanceIsSelected(e)&&t.push(e),e=this.nextVisibleInstance(e);return t},expand(){},isVisible(){return!0},wasDeleted(){return!1},toggleChildren(){},scrollIntoView(){},shiftUp(){},shiftDown(){},isLastSibling(){return!0},isFirstSibling(){return!0},resize(){},nextSiblingNoWrap(){return this},removeFromParent(){}},computed:{...Object(b["c"])({children(t){var e=t.notes[this.note_id].children;return e},note(t){return t.notes[this.note_id]}}),...Object(b["b"])(["newId"]),isSelected(){return this.instanceIsSelected(this)},isFocused(){return this.focusedInstance==this},firstSelectedInstance(){return this.selectedInstances[0]},focusedInstanceNote(){return this.focusedInstance.note},selectedInstances:{set(t){this.clearEditable(),this.$data._selectedInstances=t},get(){return this.$data._selectedInstances}},editableInstance:{set(t){t||exception(),this.selectInstance(t,!1),this.$data._editableInstance=t,this.$nextTick(function(){var t=this.$data._editableInstance.textArea;t.focus(),t.selectionEnd=t.selectionStart}.bind(this))},get(){return this.$data._editableInstance}},focusedInstance:{set(t){this.$data._focusedInstance=t},get(){return this.$data._focusedInstance}}},created(){document.addEventListener("keydown",t=>{if(0!=this.selectedInstances.length&&(null==this.editableInstance||"Alt"==t.key||"Tab"==t.key||"Insert"==t.key))switch("Space"==t.code&&t.ctrlKey&&(this.showDescriptions=!this.showDescriptions,this.resizeAll()),t.key){case"Alt":t.preventDefault(),null!=this.editableInstance&&this.clearEditable();break;case"Insert":t.preventDefault();var e=this.getNewNote();this.selectedInstances.forEach((function(t){t.addChild(e),t.expand()})),this.$forceUpdate(),t.altKey||this.$nextTick(function(){var t=[],i=this.nextVisibleInstance(this);while(i!=this)i.note==e&&t.push(i),i=this.nextVisibleInstance(i);this.selectedInstances=t,this.focus(t[0]),this.scrollIntoView(t[0])}.bind(this));break;case"Delete":var i=this.getOrderedSelectedInstances()[0],n=i.previousSibling(),s=this;this.selectedInstances.forEach((function(t){t.removeFromParent()})),this.$nextTick(function(){i!=n&&n.isVisible()?s.focus(n):this.focus(this.lowestVisibleElement(i.path()))}.bind(this));break;case"c":if(!t.ctrlKey)break;this.clipboard.notes=[],this.callFn(this.addToClipboard);break;case"v":if(!t.ctrlKey)break;this.callFn(this.attachAllNotesOnClipboard,!0,!0);break;case"Enter":t.preventDefault(),this.focusedInstance!=this&&(this.editableInstance=this.focusedInstance);break;case"ArrowUp":t.preventDefault();var r=this.focusedInstance;if(!t.shiftKey){r=this.focusedInstance;var o=this.previousVisibleInstance(r);this.focus(o,t.ctrlKey)}if(t.shiftKey){var a=this.getOrderedSelectedInstances().reverse();while(a.length>0){var c=a.pop();if(!c.isFirstSibling()){var l=c.previousSibling();if(this.instanceIsSelected(l))continue;c.shiftUp(),c.deselect(),l.select()}}this.focus(this.highestSelectedInstance(),!0)}break;case"ArrowDown":if(t.preventDefault(),!t.shiftKey){r=this.focusedInstance,o=this.nextVisibleInstance(r);this.focus(o,t.ctrlKey)}if(t.shiftKey){a=this.getOrderedSelectedInstances();while(a.length>0){c=a.pop();if(!c.isLastSibling()){var h=c.nextSibling();if(this.instanceIsSelected(h))continue;c.shiftDown(),c.deselect(),h.select()}}this.focus(this.highestSelectedInstance(),!0)}break;case"ArrowLeft":if(null!=this.editableInstance)break;t.preventDefault(),this!=this.focusedInstance&&this.focus(this.focusedInstance.$parent,t.ctrlKey);break;case"ArrowRight":if(null!=this.editableInstance)break;t.preventDefault();r=this.focusedInstance;r.$children.length>0&&this.focus(r.$children[0],t.ctrlKey);break;case"Tab":if(t.preventDefault(),this.editableInstance){var d=this.editableInstance.textArea,u=d.value,p=d.selectionStart,f=this.$store.state.CONSTANTS.TAB_WIDTH,b=f-p%f;d.value=u.substring(0,p)+" ".repeat(b)+u.substring(p),d.selectionStart=d.selectionEnd=p+b}else this.selectedInstances.forEach((function(t){t.toggleChildren()}));break}})},mounted(){this.$on("click",(function({instance:t,event:e}){t.isEditable||this.focus(t,e.ctrlKey)})),this.$on("dblclick",(function({instance:t,event:e}){this.editableInstance=t})),document.title="TNotepad",this.$refs.rootDiv.focus()}},y=S,k=(i("00f6"),Object(h["a"])(y,p,f,!1,null,"dd2e390a",null)),N=k.exports,C={name:"App",components:{ActionsBar:u,NoteContainer:N}},E=C,O=(i("1dc6"),Object(h["a"])(E,s,r,!1,null,"773831b4",null)),A=O.exports;n["a"].use(b["a"]);class D{constructor(t){this.id=t,this.content="",this.description="",this.children=[],this.autoExpand="true"}}var T=new b["a"].Store({state:{notes:{0:new D(0)},CONSTANTS:{SPELLCHECK:"false",TAB_WIDTH:4}},getters:{getContent:t=>e=>t.notes[e].content,getDescription:t=>e=>t.notes[e].description,getNotes(t){return t.notes},noteHasChild:t=>(t,e)=>-1!=t.children.indexOf(e.id),getNoteById:t=>e=>t.notes[e],newId:t=>Object.keys(t.notes).length},mutations:{registerNewNote(t,e){var i=new D(e);t.notes={...t.notes,[e]:i}},addNote(t,e){t.notes={...t.notes,note:e}},addChildToParent(t,{child:e,parent:i}){i.children.push(e.id)},removeChildFromParent(t,{child:e,parent:i}){i.children=i.children.filter(t=>t!=e.id)},setContent(t,{id:e,content:i}){t.notes[e].content=i},setDescription(t,{id:e,description:i}){t.notes[e].description=i},loadNotes(t,{new_notes:e,fileName:i}){var n=t.notes[0],s=e[0];t.notes=w.mergeNotes(t.notes,e),n.children.push(s.id),s.content=i},shiftDown(t,{parent:e,child:i}){var n=e.children,s=n.indexOf(i.id);[n[s],n[s+1]]=[n[s+1],n[s]]},shiftUp(t,{parent:e,child:i}){var n=e.children,s=n.indexOf(i.id);[n[s],n[s-1]]=[n[s-1],n[s]]}},actions:{}});i("11c1");n["a"].config.productionTip=!1,window.vue=new n["a"]({store:T,render:t=>t(A)}).$mount("#app")},"576b":function(t,e,i){"use strict";var n=i("6215"),s=i.n(n);s.a},6215:function(t,e,i){}});
//# sourceMappingURL=app.5023b4ff.js.map