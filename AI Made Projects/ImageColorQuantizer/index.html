<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Image Color Quantizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script type="module" crossorigin src="index-DRxnEmf-.js"></script>
  <link rel="stylesheet" crossorigin href="index-C9COaIWm.css">
</head>

<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="appContainer" class="w-full max-w-5xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Advanced Color Quantizer</h1>
            <p class="text-gray-600 mt-2">Reduce colors, view palettes, and measure image quality with PSNR.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 items-end">
            <div class="flex flex-col">
                <label for="imageUpload" class="mb-2 font-semibold text-gray-700">1. Upload Image</label>
                <div class="custom-file-button">
                    <label for="imageUpload"
                        class="w-full inline-flex items-center justify-center px-4 py-2 bg-gray-200 text-gray-700 rounded-lg cursor-pointer hover:bg-gray-300 transition-colors">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                        <span id="fileName">Choose a PNG file...</span>
                    </label>
                    <input id="imageUpload" type="file" accept="image/png">
                </div>
                <p class="text-sm text-gray-500 mt-2">Or drag & drop / paste a PNG image anywhere on the page.</p>
            </div>
            <div class="flex flex-col">
                <label for="colorSlider" class="mb-2 font-semibold text-gray-700">2. Number of Colors</label>
                <div class="flex items-center space-x-4">
                    <input id="colorSlider" type="range" min="2" max="256" value="16"
                        class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer" disabled>
                    <span id="sliderValue"
                        class="font-semibold text-gray-700 w-16 text-center bg-gray-100 rounded-md py-1">16</span>
                </div>
            </div>
        </div>

        <!-- Algorithm Selection Dropdown -->
        <div class="mb-6">
            <label for="algorithmSelect" class="block mb-2 font-semibold text-gray-700">3. Select Algorithm</label>
            <select id="algorithmSelect"
                class="block w-full px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-200 disabled:cursor-not-allowed"
                disabled>
                <option value="median-cut">Median Cut - Speed+ Quality+</option>
                <option value="k-means">K-means clustering - Quality++ Speed-</option>
                <option value="neuquant">NeuQuant - Speed++ Quality-- Output Size--</option>
                <option value="octree">Octree - Speed++ Quality-</option>
            </select>
        </div>

        <!-- Dithering Checkbox -->
        <div class="mb-6">
            <label for="ditheringCheckbox" class="flex items-center">
                <input type="checkbox" id="ditheringCheckbox"
                    class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" disabled>
                <span class="ml-2 text-gray-700">Apply error diffusion dithering (Floyd-Steinberg)</span>
            </label>
        </div>


        <div id="status" class="text-center my-4 text-lg text-gray-600 h-6"></div>

        <div id="resultContainer" class="grid grid-cols-1 md:grid-cols-2 gap-8 hidden">
            <div>
                <h2 class="text-xl font-semibold text-center mb-4">Original Image <span id="originalImageSize"
                        class="text-base text-gray-500 font-normal"></span></h2>
                <canvas id="originalCanvas" class="w-full h-auto rounded-lg shadow-md border border-gray-200"></canvas>
            </div>
            <div>
                <h2 class="text-xl font-semibold text-center mb-4">Quantized Image <span id="quantizedImageSize"
                        class="text-base text-gray-500 font-normal"></span></h2>
                <div class="relative" id="quantizedImageWrapper">
                    <canvas id="quantizedCanvas"
                        class="w-full h-auto rounded-lg shadow-md border border-gray-200 hidden"></canvas>
                    <div id="selectionOverlay" class="selection-overlay hidden"></div>
                    <img id="quantizedImage" class="w-full h-auto rounded-lg shadow-md border border-gray-200"
                        alt="Quantized Image Output">
                </div>
                <!-- PSNR (Quality) widget moved here -->
                <div class="mt-4 bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h4 class="font-semibold mb-2 text-gray-800">Current Quality</h4>
                    <div class="flex justify-between items-center">
                        <span class="font-medium text-gray-700">PSNR (Quality):</span>
                        <span id="psnrValue" class="font-bold text-lg text-indigo-600">N/A</span>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Peak Signal-to-Noise Ratio. Higher is better. &infin;
                        indicates a perfect match.</p>
                </div>
            </div>
        </div>

        <div id="paletteSectionContainer" class="mt-8 hidden">
            <div class="mb-4 flex items-center gap-3">
                <label for="maskColorInput" class="text-sm font-medium text-gray-700">Palette Hover Mask Color</label>
                <input type="color" id="maskColorInput"
                    class="h-10 w-12 border border-gray-300 rounded cursor-pointer"
                    value="#00ff00"
                    title="When hovering a palette color, matching pixels in the output are tinted with this color.">
                <button id="remapAllBtn" class="px-3 py-2 bg-indigo-600 text-white text-xs font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition disabled:bg-gray-400 disabled:cursor-not-allowed">Remap All</button>
            </div>

            <div class="grid grid-cols-1">
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-semibold text-gray-800">Current Palette</h4>
                        <div class="flex gap-2">
                            <button id="collapseAllBtn"
                                class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed"
                                disabled>Collapse All
                            </button>
                            <button id="exportPaletteBtn"
                                class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed"
                                disabled>Export Palette
                            </button>
                        </div>
                    </div>

                    <!-- Collapse Threshold Input -->
                    <div class="mb-4">
                        <label for="collapseThresholdInput"
                            class="block text-sm font-medium text-gray-700 mb-1">Collapse Threshold (Delta E)</label>
                        <input type="number" id="collapseThresholdInput" name="collapseThresholdInput"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            placeholder="e.g., 2.5" step="0.1" value="2.5" title="Sets the perceptual color difference (CIELAB Delta E).
1.0 = Barely perceptible difference
2.5 = Noticeable difference
10.0+ = Very different colors">
                        <p id="collapseThresholdError" class="text-sm text-red-600 mt-1 h-5"></p>
                        <!-- h-5 to prevent layout shift -->
                    </div>

                    <div id="paletteContainer"
                        class="grid grid-cols-8 sm:grid-cols-12 md:grid-cols-16 gap-2 bg-gray-50 p-4 rounded-lg">
                    </div>

                    <!-- Custom Palette Upload Section -->
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-2">Upload Custom Palette</h4>
                        <div class="flex items-center space-x-2">
                            <div class="custom-file-button flex-grow">
                                <label for="paletteUpload"
                                    class="w-full inline-flex items-center justify-center px-4 py-2 bg-gray-200 text-gray-700 rounded-lg cursor-pointer hover:bg-gray-300 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 0115.9 6L16 6a3 3 0 013 3v10a2 2 0 01-2 2H7a2 2 0 01-2-2v-1a1 1 0 011-1h1z">
                                        </path>
                                    </svg>
                                    <span id="paletteFileName">Upload Palette (TXT)...</span>
                                </label>
                                <input id="paletteUpload" type="file" accept=".txt">
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Upload a .txt file with hex (#RRGGBB or RRGGBB) or RGB
                            (R,G,B) colors, one per line.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="analysisContainer" class="mt-8 hidden">
            <h3 class="text-xl font-semibold mb-2">Analysis</h3>
            <div class="mb-6 border-b border-gray-200 pb-6">
                <button id="runFullAnalysisBtn"
                    class="bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    disabled>Run Full Analysis</button>
                <p class="text-sm text-gray-500 mt-2">Click to calculate the image quality (PSNR) for every color count
                    from 2 up to the current slider value. Results will appear in a table below.</p>
            </div>
        </div>

        <div id="fullAnalysisResults" class="mt-8 hidden">
            <h3 class="text-xl font-semibold mb-4">Full Analysis Results</h3>
            <div id="analysisTableContainer" class="w-full bg-gray-50 p-4 rounded-lg border">
                <table class="w-full text-left table-auto">
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="px-4 py-2">Color Count</th>
                            <th class="px-4 py-2">PSNR (dB)</th>
                            <th class="px-4 py-2">Delta from Previous</th>
                        </tr>
                    </thead>
                    <tbody id="analysisTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="customColorPicker" class="hidden bg-white shadow-xl p-4 rounded-lg z-10 border border-gray-200"
        style="min-width: 250px;">
        <div class="flex mb-4 border-b">
            <button id="rgbTabBtn"
                class="px-3 py-2 text-sm font-medium text-indigo-700 border-b-2 border-indigo-500 focus:outline-none">RGB</button>
            <button id="hslTabBtn"
                class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent focus:outline-none">HSL</button>
        </div>

        <div id="rgbPanel">
            <label for="nativeColorPickerInCustom" class="block text-xs font-medium text-gray-700 mb-2">Select RGB
                Color:</label>
            <input type="color" id="nativeColorPickerInCustom" value="#000000">
        </div>

        <div id="hslPanel" class="hidden">
            <div class="mb-2">
                <label for="hslH" class="block text-xs font-medium text-gray-700">Hue:</label>
                <input type="range" id="hslH" min="0" max="360" value="0"
                    class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    style="background: linear-gradient(to right, red, yellow, lime, cyan, blue, magenta, red);">
                <span id="hslHValue" class="text-xs text-gray-600">0</span>
            </div>
            <div class="mb-2">
                <label for="hslS" class="block text-xs font-medium text-gray-700">Saturation:</label>
                <input type="range" id="hslS" min="0" max="100" value="0"
                    class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    style="background: linear-gradient(to right, gray, #ff0000);">
                <span id="hslSValue" class="text-xs text-gray-600">0</span>
            </div>
            <div class="mb-2">
                <label for="hslL" class="block text-xs font-medium text-gray-700">Lightness:</label>
                <input type="range" id="hslL" min="0" max="100" value="0"
                    class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    style="background: linear-gradient(to right, black, gray, white);">
                <span id="hslLValue" class="text-xs text-gray-600">0</span>
            </div>
            <div id="hslCurrentColorDisplay" class="w-full h-8 mt-4 rounded-lg border border-gray-200"></div>
        </div>

        <div class="flex justify-between gap-2 mt-4">
            <button id="confirmColorBtn"
                class="flex-1 bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">Confirm</button>
            <button id="cancelColorBtn"
                class="flex-1 bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-transform transform hover:scale-105">Cancel</button>
        </div>
    </div>



</body>

</html>

