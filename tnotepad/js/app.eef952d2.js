(function(t){function e(e){for(var s,a,o=e[0],c=e[1],l=e[2],u=0,h=[];u<o.length;u++)a=o[u],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&h.push(i[a][0]),i[a]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);d&&d(e);while(h.length)h.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],s=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(s=!1)}s&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var s={},i={app:0},r=[];function a(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=s,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(n,s,function(e){return t[e]}.bind(null,s));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/tnotepad/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var d=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"2b7e":function(t,e,n){"use strict";var s=n("5902"),i=n.n(s);i.a},"37bd":function(t,e,n){"use strict";var s=n("c48f"),i=n.n(s);i.a},"56d7":function(t,e,n){"use strict";n.r(e);var s=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"AllContainer"}},[n("ActionsBar",{attrs:{id:"ActionsBar"}}),n("NoteContainer")],1)},r=[],a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{attrs:{id:"actionsBar"}},[n("div",{staticClass:"button cell",attrs:{id:"download_button"},on:{click:t.download}},[n("u",[t._v("D")]),t._v("ownload ")]),n("div",{staticClass:"button cell",attrs:{id:"upload_button"},on:{click:t.clickInput}},[n("u",[t._v("U")]),t._v("pload ")]),n("input",{staticClass:"cell",staticStyle:{display:"none"},attrs:{id:"in",type:"file",accept:".tnp"}})])])},o=[],c={name:"ActionsBar",components:{},data(){return{inputElement:null}},methods:{download(){var t=JSON.stringify(this.$store.state),e=new Blob([t],{type:"application/octet-binary"}),n=document.createElement("a");n.setAttribute("href",URL.createObjectURL(e)),this.stripTrailingStarOffTitleIfExists(),n.setAttribute("download",document.title+".tnp"),n.click()},upload(){var t=this.$store,e=this.inputElement.files[0];e.text().then(n=>{var s=JSON.parse(n),i=e.name.slice(0,-4);0==t.state.notes[0].children.length&&setTimeout((function(){document.title=i}),50),t.commit("loadState",{new_state:s,fileTitle:i})}),this.inputElement.value=null},clickInput(){this.inputElement.click()},stripTrailingStarOffTitleIfExists(){document.title.endsWith("*")&&(document.title=document.title.slice(0,document.title.length-1))},returnCopyWithoutOrphans(t){var e,n=JSON.parse(JSON.stringify(t));for(e in t)0!=e&&0==n[e].parents.length&&delete n[e];return n}},created(){document.addEventListener("keydown",t=>{switch(t.key){case"d":t.ctrlKey&&(t.preventDefault(),this.download());break;case"u":t.ctrlKey&&(t.preventDefault(),document.getElementById("in").click());break}})},mounted(){this.inputElement=document.getElementById("in"),this.inputElement.addEventListener("input",t=>{this.upload()})}},l=c,d=(n("ffdc"),n("2877")),u=Object(d["a"])(l,a,o,!1,null,"51ec21a9",null),h=u.exports,f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{focused:t.isFocused},attrs:{id:"NoteContainer"}},[n("NoteInstance",{staticClass:"instance",attrs:{noteid:0}})],1)},p=[],b=n("2f62"),v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{shiftRight:t.parentIsNotRoot},attrs:{id:"root"}},[n("div",{ref:"topLine",class:{flex:!0,border:!0,selected:t.isSelected,focused:t.isFocused,hidden:t.isRoot},attrs:{id:"topLine"},on:{click:t.focus,contextmenu:function(e){return e.preventDefault(),t.onRightClick(e)}}},[n("button",{class:{boldText:t.hasChildren},on:{click:t.toggleButton}},[t._v(" "+t._s(t.button_text)+" ")]),n("textarea",{directives:[{name:"show",rawName:"v-show",value:t.isEditable,expression:"isEditable"},{name:"model",rawName:"v-model:value",value:t.markup,expression:"markup",arg:"value"}],ref:"textarea",staticClass:"contentBox",attrs:{type:"text"},domProps:{value:t.markup},on:{input:function(e){e.target.composing||(t.markup=e.target.value)}}}),n("span",{directives:[{name:"show",rawName:"v-show",value:!t.isEditable,expression:"!isEditable"}],ref:"contentSpan",staticClass:"contentBox",attrs:{id:"contentSpan"},domProps:{innerHTML:t._s(t.markup)}})]),n("keep-alive",[t.isExpanded?n("div",{ref:"childrenDiv",attrs:{id:"childrenDiv"}},t._l(t.children,(function(t){return n("NoteInstance",{key:t,attrs:{noteid:t}})})),1):t._e()]),n("vue-context",{ref:"contextmenu"},[n("li",[n("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.noteContainer.DeepCopy(e)}}},[t._v("Deep Copy")])])])],1)},m=[],g=n("899b"),I={name:"NoteInstance",components:{VueContext:g["a"]},props:{noteid:Number},data(){return{noteContainer:this.$parent.noteContainer,downArrow:"Ë…",rightArrow:">",button_text:">",isEditable:!1}},methods:{ctxmenuOptionOnClick(t){console.log(`Innertext is ${t}`)},onRightClick(t,e){this.$refs.contextmenu.open(t,e),this.focus(t)},resize(){var t=this.$refs.topLine.style,e=this.isEditable?this.$refs.textarea:this.$refs.contentSpan;t.height=0,t.height=e.scrollHeight+"px"},focus(t){var e=!!t&&t.ctrlKey;this.noteContainer.focus(this,e)},addNote(t){this.$store.commit("addChildToParent",{child:t,parent:this.note})},getPreviousVisibleInstance(){if(this.$parent==this.noteContainer&&0==this.indexAsSibling)return this;var t=this.getPreviousSibling();if(t){while(t.isExpanded&&t.hasChildren)t=t.getLastChild();return t}return this.$parent},getNextVisibleInstance(){if(this.isExpanded&&this.hasChildren){var t=this.note.children[0],e=this.$store.state.notes[t],n=this.$children.filter(t=>t.note==e)[0];return n}var s=function(t){if(t.isRoot)return t;var e=t.getNextSibling();return null!=e?e:s(t.$parent)},i=s(this);return i.isRoot?this:i},getPreviousSibling(){var t=this.$parent.note.children,e=t.indexOf(this.note.id);if(e<1)return null;var n=t[e-1],s=this.$store.state.notes[n],i=this.$parent.getChildInstances().filter(t=>t.note==s)[0];return i},getNextSibling(){var t=this.$parent.note.children,e=t.indexOf(this.note.id);if(e==t.length-1)return null;var n=t[e+1],s=this.$store.state.notes[n],i=this.$parent.getChildInstances().filter(t=>t.note==s)[0];return i},getLastChild(){return this.childInstances[this.childInstances.length-1]},toggleButton(){this.button_text=this.button_text==this.rightArrow?this.downArrow:this.rightArrow},expand(){this.button_text=this.downArrow},expand_N_levels(t){this.level,this.button_text,this.markup,t>=1&&this.expand(),t>1&&this.$nextTick(function(){this.getChildInstances().forEach((function(e){e.expand_N_levels(t-1)}))}.bind(this))},collapse(){this.button_text=this.rightArrow},removeFromParent(){this.$store.commit("removeChildFromParent",{child:this.note,parent:this.$parent.note})},getChildInstances(){var t=this.$children,e=t.filter(t=>void 0!=t.note);return e},getChildInstance(t){return this.$children.filter(e=>e.note==t)[0]},getIndexAsSibling(){return this.isRoot?0:this.$parent.childInstances.indexOf(this)},addTag(t){var e=function(t){var e;switch(t){case"b":e=/<\/?b>/g;break;case"u":e=/<\/?u>/g;break;case"i":e=/<\/?i>/g;break}var n=this.markup.match(e);if(void 0==n)return!1;var s=n[n.length-1];return s!="</"+t+">"}.bind(this),n="<"+(e(t)?"/":"")+t+">";this.markup+=n}},computed:{...Object(b["b"])({children(t){return t.notes[this.noteid].children},note(t){return t.notes[this.noteid]},parentNote(t){if(!this.isRoot)return t.notes[this.$parent.note.id]}}),markup:{set(t){this.$store.commit("setMarkup",{note:this.note,markup:t}),this.resize()},get(){return this.note.markup}},path(){return this.$parent==this.noteContainer?[this]:[...this.$parent.path,this]},isVisible(){return this.$parent==this.noteContainer||!(!this.$parent.isVisible||!this.$parent.isExpanded)},childInstances(){return this.getChildInstances()},isSelected(){return this.noteContainer.selectedInstances.includes(this)},isFocused(){return this.noteContainer.focusedInstance==this},isExpanded(){return this.button_text==this.downArrow},indexAsSibling(){return this.getIndexAsSibling()},textarea(){return this.$refs.textarea},hasChildren(){return this.note.children.length>0},isRoot(){return 0==this.noteid},parentIsNotRoot(){return!this.$parent.isRoot},level(){return this.isRoot?0:this.$parent.level+1}},watch:{isEditable:function(){this.$nextTick((function(){this.resize(),this.textarea&&this.textarea.focus()}))},markup:function(){document.title.endsWith("*")||(document.title+="*"),window.tnk=this.textarea},children:function(){document.title.endsWith("*")||(document.title+="*")}},mounted(){this.resize(),this.isRoot&&(this.focus(),this.button_text=this.downArrow)}},k=I,x=(n("ea00"),n("6de1"),Object(d["a"])(k,v,m,!1,null,"3847768f",null)),w=x.exports,y={obj_val_replace:function(t,e,n){if(e!=n&&t){var s;for(s in t)s==e&&(t[n]=t[e],delete t[e]);for(s in t){var i=t[s];i==e&&(t[s]=n),"object"==typeof i&&(i instanceof Array?t[s]=i.map(t=>t==e?n:t):this.obj_val_replace(i,e,n))}}},shiftDuplicateIDs:function(t,e){var n,s=0;for(n in t)n in e&&(s=this.getNextValidID(e,t,s),this.obj_val_replace(t,n,s))},getNextValidID(t,e,n){var s=n;while(s in t||s in e)s++;return s}};s["a"].use(b["a"]);class ${constructor(t){this.id=t,this.markup="",this.children=[],this.parents=[]}}var C=new b["a"].Store({state:{notes:{0:{id:0,markup:"0",children:[],parents:[]}},settings:{showMarkup:!0},version:1},getters:{nextID:t=>Object.keys(t.notes).length,getNoteByID:t=>e=>t.notes[e]},mutations:{setMarkup(t,{note:e,markup:n}){e.markup=n},registerNewNote(t,e){var n=new $(e);t.notes={...t.notes,[e]:n}},addChildToParent(t,{child:e,parent:n}){n.children.push(e.id),e.parents.push(n.id)},removeChildFromParent(t,{child:e,parent:n}){n.children=n.children.filter(t=>t!=e.id)},loadState(t,{new_state:e,fileTitle:n}){var s=e.notes,i=s[0],r=t.notes[0];0==t.notes[0].children.length?this.replaceState(e):(y.shiftDuplicateIDs(s,t.notes),Object.assign(this.state.notes,s),this.commit("addChildToParent",{child:i,parent:r}),i.markup=n)}}});const _={COPY:1,CUT:2,DEEPCOPY:3};var E={name:"NoteContainer",components:{NoteInstance:w},data(){return{_selectedInstances:[null],_focusedInstance:null,noteContainer:this,copiedInstances:[],copy_state:null,active_modes:{b:!1,i:!1,u:!1}}},methods:{onRightClick(t){alert(`You clicked ${t}!`)},select(t,e=!1){e||(this.selectedInstances=[]),this.selectedInstances=[...this.selectedInstances,t]},focus(t,e=!1){this.focusedInstance=t,this.select(t,e)},clearSelectedInstances(){this.selectedInstances=[]},getNewNote(){var t=this.$store.getters.nextID;this.$store.commit("registerNewNote",t);var e=this.$store.getters.getNoteByID(t);return e},swapInstances(t,e){if(t.$parent==e.$parent){var n=t.$parent.note,s=n.children.indexOf(t.note.id),i=e.$parent.note,r=i.children.indexOf(e.note.id);n.children[s]=e.note.id,i.children[r]=t.note.id,t.$parent.$forceUpdate(),t.$parent!=e.$parent&&e.$forceUpdate()}},addSelectedInstancesToClipboard(){this.copiedInstances=this.selectedInstances.filter(t=>!0)},canCopy(t,e){return e.parentNote!=t.note&&t.note!=e.note},copyOne(t,e,n){n==_.CUT&&e.removeFromParent(),[_.CUT,_.COPY].includes(n)?(t.addNote(e.note),t.expand()):n==_.DEEPCOPY&&(this.deepCopy(t,e),t.expand())},deepCopy(t,e){var n=this.$store.getters.nextID;this.$store.commit("registerNewNote",n);var s=this.$store.getters.getNoteByID(n);s.markup=e.note.markup,s.children=e.note.children.filter(t=>!0),s.parents=e.note.parents.filter(t=>!0),this.$store.commit("addChildToParent",{child:s,parent:t})}},computed:{selectedInstances:{set(t){this.$data._selectedInstances=t},get(){return this.$data._selectedInstances}},focusedInstance:{set(t){this.$data._focusedInstance=t},get(){return this.$data._focusedInstance}},showMarkup:{set(t){this.$store.state.settings.showMarkup=t},get(){return this.$store.state.settings.showMarkup}},isFocused(){return this.focusedInstance==this.$children[0]},children(){return this.$children},rootInstance(){return this.$children[0]}},created(){document.addEventListener("keydown",t=>{switch(t.key){case"Enter":if(this.focusedInstance.isRoot)break;if(this.focusedInstance.isEditable){if(t.shiftKey)break;t.preventDefault();var e=this.focusedInstance.textarea,n=e.selectionEnd,s=this.focusedInstance.markup.slice(0,e.selectionStart),i=this.focusedInstance.markup.slice(e.selectionStart);this.focusedInstance.markup=s+"<br/>\n"+i,this.$nextTick(()=>{this.focusedInstance.resize(),e.selectionstart=e.selectionEnd=n+"<br/>".length+"\n".length})}else this.focusedInstance.isEditable=!0,t.preventDefault();break;case"Alt":t.preventDefault(),this.focusedInstance.isEditable&&(this.focusedInstance.isEditable=!1);break;case"Insert":if(t.preventDefault(),this.focusedInstance.isEditable)break;var r=this.getNewNote();this.selectedInstances.forEach((function(t){t.addNote(r),t.expand()})),this.$nextTick(function(){var e=this.focusedInstance.getChildInstances(),n=e.filter(t=>t.note==r)[0];t.altKey||n.focus()}.bind(this));break;case"ArrowUp":case"ArrowDown":if(this.focusedInstance.isEditable)break;if(t.shiftKey&&t.ctrlKey)break;t.preventDefault();var a,o=this.focusedInstance;if("ArrowUp"==t.key&&(a=o.getPreviousVisibleInstance()),"ArrowDown"==t.key&&(a=o.getNextVisibleInstance()),null==a)return;t.shiftKey||this.focus(a,t.ctrlKey),t.shiftKey&&(this.swapInstances(o,a),document.title.endsWith("*")||(document.title+="*"));break;case"ArrowLeft":if(this.focusedInstance.isEditable)break;if(t.preventDefault(),this.focusedInstance.isRoot)break;this.focusedInstance.$parent.focus();break;case"ArrowRight":if(this.focusedInstance.isEditable)break;t.preventDefault(),this.focusedInstance.expand(),this.$nextTick(()=>{var t=this.focusedInstance.getChildInstances();t.length>0&&t[0].focus()});break;case"Tab":if(t.preventDefault(),this.focusedInstance.isRoot)break;if(this.focusedInstance.isEditable)break;this.selectedInstances.forEach((function(t){t.toggleButton()}));break;case"Delete":if(t.preventDefault(),this.focusedInstance.isEditable)break;if(0==this.focusedInstance.noteid)break;var c=this.focusedInstance.getPreviousVisibleInstance();while(c in this.selectedInstances)c=c.getPreviousVisibleInstance();this.selectedInstances.forEach((function(t){t.removeFromParent()})),c.focus();case"c":case"x":case"b":!this.focusedInstance.isEditable&&t.ctrlKey&&("c"==t.key&&(this.copy_state=_.COPY),"x"==t.key&&(this.copy_state=_.CUT),"b"==t.key&&(this.copy_state=_.DEEPCOPY),this.addSelectedInstancesToClipboard());break;case"v":!this.focusedInstance.isEditable&&t.ctrlKey&&this.selectedInstances.forEach(function(t){this.copiedInstances.forEach(function(e){this.canCopy(t,e)&&this.copyOne(t,e,this.copy_state)}.bind(this))}.bind(this));break;case"b":case"u":case"i":if(this.focusedInstance.isEditable&&t.ctrlKey){t.preventDefault();e=this.focusedInstance.textarea;if(e.selectionStart==e.selectionEnd)this.focusedInstance.addTag(t.key);else{var l=this.focusedInstance.markup;s=e.selectionStart,i=e.selectionEnd;this.focusedInstance.markup=l.slice(0,s)+`<${t.key}>`+l.slice(s,i)+`</${t.key}>`+l.slice(i)}}break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(!t.ctrlKey)break;t.preventDefault(),this.focusedInstance.expand_N_levels(Number.parseInt(t.key))}})},mounted(){}},N=E,O=(n("37bd"),Object(d["a"])(N,f,p,!1,null,"0c5719be",null)),D=O.exports,S={name:"App",components:{ActionsBar:h,NoteContainer:D},mounted(){window.onbeforeunload=function(){if(document.title.endsWith("*"))return""}}},P=S,T=(n("2b7e"),Object(d["a"])(P,i,r,!1,null,"2a83bbc1",null)),A=T.exports;s["a"].config.productionTip=!1,window.vue=new s["a"]({store:C,render:t=>t(A)}).$mount("#app")},5902:function(t,e,n){},"6de1":function(t,e,n){"use strict";var s=n("a86b"),i=n.n(s);i.a},a86b:function(t,e,n){},c48f:function(t,e,n){},ea00:function(t,e,n){"use strict";var s=n("ebb8"),i=n.n(s);i.a},ebb8:function(t,e,n){},f158:function(t,e,n){},ffdc:function(t,e,n){"use strict";var s=n("f158"),i=n.n(s);i.a}});
//# sourceMappingURL=app.eef952d2.js.map