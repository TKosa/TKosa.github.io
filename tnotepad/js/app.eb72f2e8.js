(function(t){function e(e){for(var i,o,a=e[0],c=e[1],l=e[2],h=0,u=[];h<a.length;h++)o=a[h],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&u.push(s[o][0]),s[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);d&&d(e);while(u.length)u.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,a=1;a<n.length;a++){var c=n[a];0!==s[c]&&(i=!1)}i&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},s={app:0},r=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/tnotepad/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var d=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"113a":function(t,e,n){"use strict";var i=n("2b02"),s=n.n(i);s.a},"2b02":function(t,e,n){},"2f6b":function(t,e,n){"use strict";var i=n("39f8"),s=n.n(i);s.a},"39f8":function(t,e,n){},"4b2d":function(t,e,n){"use strict";var i=n("e3c0"),s=n.n(i);s.a},"56d7":function(t,e,n){"use strict";n.r(e);var i=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"AllContainer"}},[n("ActionsBar",{attrs:{id:"ActionsBar"}}),n("NoteContainer")],1)},r=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{attrs:{id:"actionsBar"}},[n("div",{staticClass:"button cell",attrs:{id:"download_button"},on:{click:t.download}},[t._v(" Download ")]),n("div",{staticClass:"button cell",attrs:{id:"upload_button"},on:{click:t.clickInput}},[t._v(" Upload ")]),n("input",{staticClass:"cell",staticStyle:{display:"none"},attrs:{id:"in",type:"file",accept:".tnp"}})])])},a=[],c={name:"ActionsBar",components:{},data(){return{inputElement:null}},methods:{download(){var t=this.$store.state.notes;t=this.returnCopyWithoutOrphans(t);var e=JSON.stringify(t),n=new Blob([e],{type:"application/octet-binary"}),i=document.createElement("a");i.setAttribute("href",URL.createObjectURL(n)),i.setAttribute("download",document.title+".tnp"),i.click()},upload(){var t=this.$store,e=this.inputElement.files[0];"TNotepad"==document.title&&(document.title=e.name.slice(0,-4)),e.text().then(n=>{var i=JSON.parse(n);t.commit("loadNotes",{new_notes:i,fileName:e.name})}),this.inputElement.value=null},clickInput(){this.inputElement.click()},returnCopyWithoutOrphans(t){var e,n=JSON.parse(JSON.stringify(t));for(e in t)0!=e&&0==n[e].parents.length&&delete n[e];return n}},created(){document.addEventListener("keydown",t=>{switch(t.key){case"s":t.ctrlKey&&(t.preventDefault(),this.download());break;case"o":t.ctrlKey&&(t.preventDefault(),document.getElementById("in").click());break}})},mounted(){this.inputElement=document.getElementById("in"),this.inputElement.addEventListener("input",t=>{this.upload()})}},l=c,d=(n("d582"),n("2877")),h=Object(d["a"])(l,o,a,!1,null,"0fd55436",null),u=h.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{focused:t.isFocused},attrs:{id:"NoteContainer"}},[n("NoteInstance",{staticClass:"instance",attrs:{noteid:0}})],1)},f=[],b=n("2f62"),v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{shiftRight:t.parentIsNotRoot},attrs:{id:"root"}},[n("div",{ref:"topLine",class:{flex:!0,border:!0,selected:t.isSelected,focused:t.isFocused,hidden:t.isRoot},attrs:{id:"topLine"},on:{click:t.focus}},[n("button",{class:{boldText:t.hasChildren},on:{click:t.toggleButton}},[t._v(" "+t._s(t.button_text)+" ")]),n("textarea",{directives:[{name:"show",rawName:"v-show",value:t.isEditable,expression:"isEditable"},{name:"model",rawName:"v-model:value",value:t.markup,expression:"markup",arg:"value"}],ref:"textarea",staticClass:"contentBox",attrs:{type:"text"},domProps:{value:t.markup},on:{input:function(e){e.target.composing||(t.markup=e.target.value)}}}),n("span",{directives:[{name:"show",rawName:"v-show",value:!t.isEditable,expression:"!isEditable"}],ref:"contentSpan",staticClass:"contentBox",attrs:{id:"contentSpan"},domProps:{innerHTML:t._s(t.markup)}})]),n("keep-alive",[t.isExpanded?n("div",{attrs:{id:"children"}},t._l(t.children,(function(t){return n("NoteInstance",{attrs:{noteid:t}})})),1):t._e()])],1)},g=[],m={name:"NoteInstance",components:{},props:{noteid:Number},data(){return{noteContainer:this.$parent.noteContainer,downArrow:"Ë…",rightArrow:">",button_text:this.downArrow,isEditable:!1,selectionStart:0}},methods:{resize(){var t=this.$refs.topLine.style,e=this.isEditable?this.$refs.textarea:this.$refs.contentSpan;t.height=0,t.height=e.scrollHeight+"px"},focus(t,e=!1){t&&!t.ctrlKey&&this.noteContainer.clearSelectedInstances(),this.noteContainer.focus(this,e)},addNote(t){this.$store.commit("addChildToParent",{child:t,parent:this.note}),this.expand()},getPreviousVisibleInstance(){if(this.$parent==this.noteContainer&&0==this.indexAsSibling)return this;if(this.previousSibling){var t=this.previousSibling;while(t.isExpanded&&t.hasChildren)t=t.$children.length>0?t.$children[t.$children.length-1]:null;return t}return this.$parent},getNextVisibleInstance(){if(this.isExpanded&&this.$children.length>0)return this.$children[0];var t=function(e){if(e.isRoot)return e;var n=e.getNextSibling();return null!=n?n:t(e.$parent)},e=t(this);return e.isRoot?this:e},getPreviousSibling(){return this.indexAsSibling>0?this.$parent.$children[this.indexAsSibling-1]:null},getNextSibling(){return this.indexAsSibling==this.$parent.$children.length-1?null:this.$parent.$children[this.indexAsSibling+1]},getLastChild(){return this.$children.length>0?this.$children[this.$children.length-1]:null},toggleButton(){this.button_text=this.button_text==this.rightArrow?this.downArrow:this.rightArrow},expand(){this.button_text=this.downArrow},collapse(){this.button_text=this.rightArrow},removeFromParent(){this.$store.commit("removeChildFromParent",{child:this.note,parent:this.$parent.note})}},computed:{...Object(b["b"])({children(t){return t.notes[this.noteid].children},note(t){return t.notes[this.noteid]}}),markup:{set(t){this.$store.commit("setMarkup",{note:this.note,markup:t}),this.resize()},get(){return this.note.markup}},path(){return this.$parent==this.noteContainer?[this]:[...this.$parent.path,this]},isVisible(){return this.$parent==this.noteContainer||!(!this.$parent.isVisible||!this.$parent.isExpanded)},isSelected(){return this.noteContainer.selectedInstances.includes(this)},isFocused(){return this.noteContainer.focusedInstance==this},isExpanded(){return this.button_text==this.downArrow},indexAsSibling(){return this.$parent.$children.indexOf(this)},previousSibling(){return this.indexAsSibling>0?this.$parent.$children[this.indexAsSibling-1]:null},nextSibling(){return this.indexAsSibling==this.$parent.$children.length-1?null:this.$parent.$children[this.indexAsSibling+1]},textarea(){return this.$refs.textarea},hasChildren(){return this.note.children.length>0},isRoot(){return this.$parent==this.noteContainer},parentIsNotRoot(){return!this.$parent.isRoot}},watch:{isEditable:function(){this.$nextTick((function(){this.resize(),this.textarea&&this.textarea.focus()}))}},mounted(){this.resize(),this.button_text=this.rightArrow,this.isRoot&&(this.button_text=this.downArrow),this.$parent.isRoot&&0==this.indexAsSibling&&this.focus()}},w=m,x=(n("2f6b"),Object(d["a"])(w,v,g,!1,null,"20af9e5a",null)),$=x.exports,I={obj_val_replace:function(t,e,n){if(e!=n&&t){var i;for(i in t)i==e&&(t[n]=t[e],delete t[e]);for(i in t){var s=t[i];s==e&&(t[i]=n),"object"==typeof s&&(s instanceof Array?t[i]=s.map(t=>t==e?n:t):this.obj_val_replace(s,e,n))}}},mergeNotes:function(t,e){var n,i={},s=0;for(n in[t,e].forEach(function(t){for(n in t)this.obj_val_replace(t,n,s),s--;Object.assign(i,t)}.bind(this)),i)this.obj_val_replace(i,n,-n);return i}};i["a"].use(b["a"]);class k{Hi(){console.log("hi")}constructor(t,e="",n=[],i=[]){this.id=t,this.markup=e,this.children=n,this.parents=i}}var y=new b["a"].Store({state:{notes:{0:{id:0,markup:"",children:[1],parents:[]},1:{id:1,markup:"",children:[],parents:[0]}},settings:{showMarkup:!1}},getters:{testGetter:t=>(console.log(void 0),console.log("testGetter"),1),nextID:t=>Object.keys(t.notes).length,getNoteByID:t=>e=>t.notes[e]},mutations:{testMutation(t){console.log("testMutation")},setMarkup(t,{note:e,markup:n}){e.markup=n},registerNewNote(t,e){var n=new k(e);t.notes={...t.notes,[e]:n}},addChildToParent(t,{child:e,parent:n}){n.children.push(e.id),e.parents.push(n.id)},removeChildFromParent(t,{child:e,parent:n}){n.children=n.children.filter(t=>t!=e.id)},loadNotes(t,{new_notes:e,file_name:n}){var i=e[0],s=t.notes[0];t.notes=I.mergeNotes(t.notes,e),this.commit("addChildToParent",{child:s,parent:i})}}}),_={name:"NoteContainer",components:{NoteInstance:$},data(){return{_selectedInstances:[this],_focusedInstance:this,noteContainer:this,copiedInstances:[]}},methods:{select(t,e=!1){e||(this.selectedInstances=[]),this.selectedInstances=[...this.selectedInstances,t]},focus(t,e=!1){this.focusedInstance=t,this.select(t,e)},clearSelectedInstances(){this.selectedInstances=[]},getNewNote(){var t=this.$store.getters.nextID;this.$store.commit("registerNewNote",t);var e=this.$store.getters.getNoteByID(t);return e},swapInstances(t,e){var n=t.$parent.note,i=n.children.indexOf(t.note.id),s=e.$parent.note,r=s.children.indexOf(e.note.id);n.children[i]=e.note.id,s.children[r]=t.note.id;var o=[],a=[],c=function(t,e){e[0]=t.button_text,t.$children.forEach((function(t){var n=[];e.push(n),c(t,n)}))};c(t,o),console.log(o),c(e,a),console.log(a),t.$parent.$forceUpdate(),t.$parent!=e.$parent&&e.$forceUpdate()}},computed:{selectedInstances:{set(t){this.$data._selectedInstances=t},get(){return this.$data._selectedInstances}},focusedInstance:{set(t){this.$data._focusedInstance=t},get(){return this.$data._focusedInstance}},showMarkup:{set(t){this.$store.state.settings.showMarkup=t},get(){return this.$store.state.settings.showMarkup}},isFocused(){return this.focusedInstance==this.$children[0]}},created(){document.addEventListener("keydown",t=>{switch(t.key){case"Enter":this.focusedInstance.isEditable?this.focusedInstance.$nextTick(function(){var t=this.focusedInstance.textarea;t.value=t.value.slice(0,t.selectionStart)+"<br/>"+t.value.slice(t.selectionStart)}.bind(this)):(this.focusedInstance.isEditable=!0,t.preventDefault());break;case"Alt":t.preventDefault(),this.focusedInstance.isEditable&&(this.focusedInstance.selectionStart=this.focusedInstance.textarea.selectionStart,this.focusedInstance.isEditable=!1);break;case"Insert":if(t.preventDefault(),this.focusedInstance.isEditable)return;var e=this.getNewNote();this.selectedInstances.forEach((function(t){t.addNote(e),t.expand()})),this.$nextTick(function(){this.focusedInstance.$children.filter(t=>t.note==e)[0].focus()}.bind(this));break;case"ArrowUp":case"ArrowDown":if(this.focusedInstance.isEditable)break;if(t.shiftKey&&t.ctrlKey)break;t.preventDefault();var n,i=this.focusedInstance;"ArrowUp"==t.key&&(n=i.getPreviousVisibleInstance()),"ArrowDown"==t.key&&(n=i.getNextVisibleInstance()),t.shiftKey||this.focus(n,t.ctrlKey),t.shiftKey&&("ArrowUp"==t.key&&(n=i.previousSibling),"ArrowDown"==t.key&&(n=i.nextSibling),null!=n&&(this.swapInstances(i,n),n.focus()));break;case"Tab":t.preventDefault(),this.selectedInstances.forEach((function(t){t.toggleButton()}));break;case"Delete":if(t.preventDefault(),this.$parent==this.noteContainer&&0==this.indexAsSibling)break;this.selectedInstances.forEach((function(t){t.removeFromParent()}));i=this.focusedInstance;var s,r=i.path.map(t=>t);r.pop();while(r.length>0)if(s=r.pop(),s.isVisible){console.log(s),this.selectedInstances=[],this.focus(s);break}break;case"c":!this.focusedInstance.isEditable&&t.ctrlKey&&(this.copiedInstances=this.selectedInstances.filter(t=>!0));break;case"v":!this.focusedInstance.isEditable&&t.ctrlKey&&this.selectedInstances.forEach(function(t){this.copiedInstances.forEach((function(e){t.addNote(e.note)}))}.bind(this));break}})},mounted(){}},E=_,S=(n("113a"),Object(d["a"])(E,p,f,!1,null,"703b913d",null)),N=S.exports,A={name:"App",components:{ActionsBar:u,NoteContainer:N}},C=A,O=(n("4b2d"),Object(d["a"])(C,s,r,!1,null,"86b6112a",null)),j=O.exports;i["a"].config.productionTip=!1,window.vue=new i["a"]({store:y,render:t=>t(j)}).$mount("#app")},d582:function(t,e,n){"use strict";var i=n("e476"),s=n.n(i);s.a},e3c0:function(t,e,n){},e476:function(t,e,n){}});
//# sourceMappingURL=app.eb72f2e8.js.map